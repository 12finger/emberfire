"use strict";!function(){void 0!==window.DS&&(DS.FirebaseSerializer=DS.JSONSerializer.extend(Ember.Evented,{normalize:function(a,b){var c=Ember.get(a,"relationshipsByName"),d=Ember.get(a,"relationshipNames");return Ember.isArray(d.hasMany)&&d.hasMany.forEach(function(d){var e=c.get(d);if("object"!=typeof b[d]||Ember.isArray(b[d])){if(Ember.isArray(b[d]))throw new Error('%@ relationship %@(\'%@\') must be a key/value map in Firebase. Example: { "%@": { "%@_id": true } }'.fmt(a.toString(),e.kind,e.type.typeKey,e.key,e.type.typeKey))}else b[d]=Ember.keys(b[d])}),this._super.apply(this,arguments)},extractSingle:function(a,b,c){return this.normalize(b,c)},extractArray:function(a,b,c){return c.map(function(c){return this.extractSingle(a,b,c)},this)}}),DS.FirebaseAdapter=DS.Adapter.extend(Ember.Evented,{init:function(){if(!this.firebase||"object"!=typeof this.firebase)throw new Error("Please set the `firebase` property on the adapter.");this._ref=this.firebase.ref()},generateIdForRecord:function(){return this._ref.push().name()},find:function(a,b,c){var d=!1,e=this._getRef(b,c),f=a.serializerFor(b);return new Ember.RSVP.Promise(function(c,g){e.on("value",function(e){var h=e.val();null!==h&&"object"==typeof h&&(h.id=e.name()),d?null===h&&a.hasRecordForId(b,e.name())?a.getById(b,e.name()).destroyRecord():a.push(b,f.extractSingle(a,b,h)):(d=!0,null===h?Ember.run(null,g):Ember.run(null,c,h))},function(a){d||Ember.run(null,g,a)})},"DS: FirebaseAdapter#find "+b+" to "+e.toString())},findAll:function(a,b){function c(c){if(d){var e=c.val();e.id=c.name(),a.push(b,f.extractSingle(a,b,e))}}var d=!1,e=this._getRef(b),f=a.serializerFor(b);return new Ember.RSVP.Promise(function(f,g){var h=function(a){d||(d=!0,Ember.run(null,g,a))};e.on("child_added",c,h),e.on("child_changed",c,h),e.on("child_removed",function(c){d&&a.hasRecordForId(b,c.name())&&a.deleteRecord(a.getById(b,c.name()))},h),e.once("value",function(a){var b=[];a.forEach(function(a){var c=a.val();c.id=a.name(),b.push(c)}),d=!0,Ember.run(null,f,b)})},"DS: FirebaseAdapter#findAll "+b+" to "+e.toString())},createRecord:function(a,b,c){return this.updateRecord(a,b,c)},updateRecord:function(a,b,c){var d=c.serialize({includeId:!1}),e=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){var f=[];c.eachRelationship(function(a,b){if("hasMany"===b.kind){var c=d[a];Ember.isArray(c)&&c.forEach(function(b){var c=e.child(a).child(b),d=Ember.RSVP.defer();f.push(d.promise),c.set(!0,function(a){a?("object"==typeof a&&(a.location=c.toString()),d.reject(a)):d.resolve()})}),delete d[a]}});var g=Ember.RSVP.defer();f.push(g.promise),e.update(d,function(a){a?g.reject(a):g.resolve()}),Ember.RSVP.allSettled(f).then(function(c){var d=c.filterBy("state","rejected");0===d.get("length")?Ember.run(null,a):Ember.run(null,b,{message:"Some errors were encountered while saving",errors:d.mapBy("reason")})})},"DS: FirebaseAdapter#updateRecord "+b+" to "+e.toString())},deleteRecord:function(a,b,c){var d=this._getRef(b,c.id);return new Ember.RSVP.Promise(function(a,b){d.remove(function(c){c?Ember.run(null,b,c):Ember.run(null,a)})},"DS: FirebaseAdapter#deleteRecord "+b+" to "+d.toString())},pathForType:function(a){var b=Ember.String.camelize(a);return Ember.String.pluralize(b)},_getRef:function(a,b){var c=this._ref;return a&&(c=c.child(this.pathForType(a.typeKey))),b&&(c=c.child(b)),c}}))}();